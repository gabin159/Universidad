<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/layout7 :: head}"></head>
<body class="m-0 p-0 font-sans bg-[url('/images/estudiantes1.jpg')]
        bg-cover bg-center bg-fixed">

<header th:replace="~{layout/layout7 :: header}"></header>
<div class="max-w-md mx-auto mt-24 mb-12 bg-white/90 rounded-xl p-8 shadow-2xl">

    <h1 class="text-center text-2xl font-bold text-gray-800 mb-4">Editar Startup</h1>

    <form th:action="@{/modificarStartup/{id}(id=${startupEdit.idStartup})}"
          method="post" enctype="multipart/form-data" th:object="${startupEdit}">
        <div class="flex flex-col gap-4">

            <label for="nombre" class="text-stone-900 font-bold">Nombre:</label>
            <input id="nombre" type="text" th:field="*{nombre}" required class="p-2 rounded-md border border-gray-300"/>

            <label for="descripcion" class="text-stone-900 font-bold">Descripción:</label>
            <input id="descripcion" type="text" th:field="*{descripcion}" required class="p-2 rounded-md border border-gray-300"/>

            <label for="sector" class="text-stone-900 font-bold">Sector:</label>
            <input id="sector" type="text" th:field="*{sector}" required class="p-2 rounded-md border border-gray-300"/>

            <label for="usuario" class="text-stone-900 font-bold">Usuario:</label>
            <select id="usuario" th:field="*{usuario.idUsuario}" required class="p-2 rounded-md border border-gray-300">
                <option th:each="user : ${listaUsuario}"
                        th:value="${user.idUsuario}"
                        th:text="${user.nombreUsuario}">
                </option>
            </select>

            <label for="convocatoria" class="text-stone-900 font-bold">Convocatoria:</label>
            <select id="convocatoria" th:field="*{convocatoria.idConvocatorias}" required class="p-2 rounded-md border border-gray-300">
                <option th:each="conv : ${listaConvocatoria}"
                        th:value="${conv.idConvocatorias}"
                        th:text="${conv.titulo}">
                </option>
            </select>

            <label for="foto" class="text-stone-900 font-bold">Logo:</label>
            <div class="flex items-center gap-4">
                <input type="file" id="foto" name="foto" accept="image/*" class="hidden" onchange="updateFileName(this)"/>
                <label for="foto" class="cursor-pointer bg-slate-600 text-white px-4 py-1 rounded hover:bg-slate-700">Seleccionar archivo</label>
                <span id="file-name" class="text-sm text-gray-600 truncate max-w-xs"
                      th:text="${startupEdit.logo != null ? startupEdit.logo : 'No file selected'}"></span>
            </div>

            <div class="flex justify-center mt-4">
                <img id="preview" src="#" alt="Vista previa"
                     class="w-48 h-48 object-cover rounded-xl border-4 border-stone-300 shadow-xl bg-white/70"
                     th:src="${startupEdit.logo != null ? startupEdit.logo : '/images/default-logo.jpg'}"/>
            </div>

            <input type="hidden" name="logoAnterior" th:value="${startupEdit.logo}"/>

            <button type="submit"
                    class="bg-amber-600 text-white py-3 px-4 rounded-md font-bold hover:opacity-70 transition-all">
                Guardar Startup
            </button>

        </div>
    </form>
</div>

<script>
    const preview = document.getElementById("preview");
    const originalSrc = preview.src;  // Guardar src original para restaurar si se cancela selección

    const inputLogo = document.getElementById("foto"); // ID actualizado
    inputLogo.addEventListener("change", function () {
        const file = this.files[0];
        if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
        } else {
            preview.src = originalSrc;
            preview.classList.remove("hidden");
        }
    });

    function updateFileName(input) {
        const label = document.getElementById('file-name');
        if (input.files && input.files.length > 0) {
            label.textContent = input.files[0].name;
        } else {
            label.textContent = "No file selected";
        }
    }
</script>

</body>
</html>
